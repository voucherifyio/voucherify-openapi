---
title: "Fetch Braze Connected Content"
description: "Fetch data from Voucherify and send messages to Braze segments"
keywords: ['integration', 'braze']
---

<Info>

    <Badge color="gray">Prerequisite: Understand Voucherify and Braze Connected Content basics</Badge>

    Read [Learn Braze Connected Content](/integrations/braze-connected-content) first to understand basics of this integration and to set up connected content correctly.

</Info>

## Experiment with ready-made Connected Content scripts

<Note>

    Head over to our [Github Repository](https://github.com/voucherifyio/braze-connected-content) to see examples of connected content scripts.

</Note>

<Warning>

    Keep in mind that all examples below use Voucherify publication source id, and Braze cache and retry parameters to limit API calls invoked by a Braze campaign. You must be aware of the following consequences: 

    *   It isn't possible to publish and send different codes to the same customer in a single Braze campaign.
    *   If your Voucherify campaign uses the **join only once feature**, you need to remove `source_id` from the connected content body as described [here](#customer-can-join-only-once).

</Warning>

### Publish and send unique coupon code

In this example, the Connected Content script calls Voucherify API to publish a unique coupon code and send it in the Braze message. Each Braze user receives only one unique code. 

```liquid
{% assign braze_campaign_id = {{campaign.${api_id}}} %}
{% assign customer_id = {{${user_id}}} %}
{% assign source_id = braze_campaign_id | append: customer_id %}
{% assign voucherify_campaign_id = "CAMPAIGN_ID" %}
{% assign cache_id = source_id %}

{% connected_content 
   YOUR API ENDPOINT/v1/publications?cache_id={{cache_id}}
   :method post
   :headers {
        "X-App-Id": "VOUCHERIFY-APP-ID",
        "X-App-Token": "VOUCHERIFY-APP-TOKEN"
   }
   :body campaign={{voucherify_campaign_id}}&customer={{customer_id}}&channel=Braze&source_id={{source_id}}
   :content_type application/json
   :cache_max_age
   :retry
   :save publication
 %}
```

### Invite new referrers

This Connected Content script enables you to publish and send unique referral codes to selected Braze users. Each user receives only one referral code to share with other users and gain new referrals. 

```liquid
{% assign braze_campaign_id = {{campaign.${api_id}}} %}
{% assign customer_id = {{${user_id}}} %}
{% assign source_id = braze_campaign_id | append: customer_id %}
{% assign voucherify_campaign_id = "CAMPAIGN_ID" %}
{% assign cache_id = source_id %}

{% connected_content 
   YOUR API ENDPOINT/v1/publications?cache_id={{cache_id}}
   :method post
   :headers {
  	"X-App-Id": "VOUCHERIFY-APP-ID",
        "X-App-Token": "VOUCHERIFY-APP-TOKEN"
   }
   :body campaign={{voucherify_campaign_id}}&customer={{customer_id}}&channel=Braze&source_id={{source_id}}
   :content_type application/json
   :cache_max_age
   :retry
   :save publication
 %}
```

### Fetch loyalty card balance

Here is an example of a Connected Content script that pulls the current loyalty balance based on the loyalty card code that was sent beforehand to Braze as a custom attribute. Note that you need to store the loyalty card code as a custom attribute in Braze user’s profile before using this script.

```liquid
{% assign braze_campaign_id = {{campaign.${api_id}}} %}
{% assign customer_id = {{${user_id}}} %}
{% assign source_id = braze_campaign_id | append: customer_id %}
{% assign voucherify_campaign_id = "CAMPAIGN_ID" %}
{% assign cache_id = source_id %}

{% connected_content 
   YOUR API ENDPOINT/v1/loyalties/{{voucherify_campaign_id}}/members/{{custom_attribute.${loyalty.card}}}?cache_id={{cache_id}}
   :method get
   :headers {
	"X-App-Id": "VOUCHERIFY-APP-ID", 
        "X-App-Token": "VOUCHERIFY-APP-TOKEN"
   }
   :content_type application/json
   :cache_max_age
   :retry
   :save member
 %}
```

## Display fetched data in Braze messages

We’re assuming you already have a Braze campaign or canva in which you want to use the connected content script. 

### Step 1: Add connected content script to message template

1. Copy and paste the Connected Content script under the `<body>` tag in a message HTML template. 
Replace **CAMPAIGN\_ID** with a Voucherify `campaign_id` copied from the URL address of Voucherify campaign dashboard.

```liquid
{% assign voucherify_campaign_id = "camp_Y7h1meBSyybsNs7UpSVVZZce}"	
```

2. Paste your API endpoint. If you don't know what your API endpoint is, you can check it in the Project settings > General > API endpoint.
    
```
YOUR API ENDPOINT/v1/publications?cache_id={{cache_id}}	
```

| Shared Cluster     | Endpoint for Braze Connected Content |
| ------------------ | ------------------------------------ |
| Europe (default)   | `https://api.voucherify.io/v1/publications` |
| United States      | `https://us1.api.voucherify.io/v1/publications` |
| Asia (Singapore)   | `https://as1.api.voucherify.io/v1/publications` |
    
3. Add your API keys for authentication. You can find **Voucherify-App-Id** and ** in **Project Settings** > **General** > **Application Keys**.
    
```
"X-App-Id": "VOUCHERIFY-APP-ID",
"X-App-Token": "VOUCHERIFY-APP-TOKEN"	
```

Now your Connected Content script is ready to go.

```liquid
{% assign braze_campaign_id = {{campaign.${api_id}}} %}
{% assign customer_id = {{${user_id}}} %}
{% assign source_id = braze_campaign_id | append: customer_id %}
{% assign voucherify_campaign_id = "camp_Y7h1meBSyybsNs7UpSVVZZce" %}
{% assign cache_id = source_id %}

{% connected_content 
   https://api.voucherify.io/v1/publications?cache_id={{cache_id}}
   :method post
   :headers {
        "X-App-Id": "490a3fb6-a",
        "X-App-Token": "328099d5-a"
   }
   :body campaign={{voucherify_campaign_id}}&customer={{customer_id}}&channel=Braze&source_id={{source_id}}
   :content_type application/json
   :cache_max_age
   :retry
   :save publication
 %}
```

### Step 2: Create snippet to display fetched data

Responses from the Voucherify API is stored by connected content under the value of `:save` parameter. For example:

```
:save member
```

This enables you to retrieve and display data from a Voucherify response in Braze messages.

You can create snippets that display the published code, loyalty card balance, expiration date, and other parameters included in JSON format response from the Voucherify API.

For example, to display the published code in a message template, you need to create a snippet that fetches a unique code from the voucher object.

Connected content script:

```liquid
{% assign braze_campaign_id = {{campaign.${api_id}}} %}
{% assign customer_id = {{${user_id}}} %}
{% assign cache_id = braze_campaign_id | append: customer_id %}
{% assign voucherify_campaign_id = "CAMPAIGN_ID" %}

{% connected_content 
   https://api.voucherify.io/v1/publications?cache_id={{cache_id}}
   :method post
   :headers {
	"X-App-Id": "VOUCHERIFY-APP-ID",
	"X-App-Token": "VOUCHERIFY-APP-TOKEN"
   }
   :body campaign={{voucherify_campaign_id}}&customer={{customer_id}}&channel=Braze
   :content_type application/json
   :cache_max_age
   :retry
   :save publication //Here
 %}
```

Snippet in Braze message template:

```liquid
{{publication.voucher.code}}
```

As a result, each customer gets a message with a unique code automatically assigned to their profile. Each time the user receives a code, it is published to their profile in Voucherify.

To display a loyalty card balance fetched from the Voucherify API, you need to create the following snippet:

```liquid
{{member.loyalty_card.balance}}
```

where the member is a value of the `:save` parameter in Connected Content script.

```liquid
:save member
```

<Tip>
It's better not to entirely depend on the 'Preview mode' and to send several test messages to confirm that everything works as it should.
</Tip>

### Step 3: Set up rate limiter

When setting up a campaign target, use advanced settings to limit the number of messages sent per minute.

Read more about Rate Limiter and Frequency Capping in Braze [documentation](https://www.braze.com/docs/user_guide/engagement_tools/campaigns/building_campaigns/rate-limiting/#delivery-speed-rate-limiting).

